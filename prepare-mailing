#! /usr/bin/python
import os.path
import pancito.mail

template = os.path.join(pancito.datadir, "mail.tmpl")
maildir = os.path.join(pancito.datadir, "mail")
if len(os.listdir(maildir)) > 0:
    raise Exception("tmp/mail is not empty, aborting to prevent side effects.")

conn = pancito.opendb()
c = conn.cursor()
c.execute("SELECT * FROM user WHERE ismailing")
for user in c.fetchall():
    pancito.mail.writeMail(user, maildir, template)
