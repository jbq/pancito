#encoding utf-8
#import base
#extends base.base

#def content
#if $params.getfirst('admin')
<h1>Commandes de ${user.name}</h1>
#elif not($success)
<p class="info">Pour commander du pain, renseignez la quantité puis cliquez sur le bouton <i>Enregistrer</i></p>
#end if

<form method="POST">
#for $bake in $bakes
#set $orders = $bake.orders.get($user.rowid) or {}
<div class="main">
<h2>Fournée du $bake.bakedate.strftime("%A %d %B %Y")</h2>
<div class="content">
#if $bake.initialOrders.get($user.rowid)
<div class="warning" style="margin: .5em">Cette commande a déjà enregistrée le $orders.get(1).creation_time.strftime("%A %d %B %Y") à $orders.get(1).creation_time.strftime("%Hh%M")</div>
#end if
<table class="order">
#for $product in $products
#set $order = $orders.get($product.rowid)
<tr>
<td>
<i>
$product.name
</i>
</td>
<td>
Quantité:&nbsp;
#if $order
#set $qty = $order.quantity
#else
#set $qty = 0
#end if
<input type="text" name="bake.${bake.rowid}.${product.rowid}" value="$qty">
</td>
</tr>
#end for
<tr>
<td class="submit" colspan=2>
<div style="text-align: right">
<input type="submit" value="Enregistrer">
</div>
</td>
</tr>
</table>
</div>
</div>
#end for
</form>
#end def
